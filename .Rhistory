labs(title = 'PCA', x='Dim1 (73.8%)', y= 'Dim2 (19.8%)')+
stat_ellipse()+
theme_bw(14)
ggplot(cbind(basic_plot$data, blups_merged_v2[, c('Trt', 'note', 'Group')]), aes(x=x, y=y, col=Group))+
geom_point(aes(shape= Trt), size=2)+
scale_shape_manual(values = c(1,2))+
labs(title = 'PCA', x='Dim1 (73.8%)', y= 'Dim2 (19.8%)')+
stat_ellipse()+
theme_bw(14)
ggplot(cbind(basic_plot$data, blups_merged_v2[, c('Trt', 'note', 'Group')]), aes(x=x, y=y, shape=Trt))+
geom_point(aes(col=Group), size=2)+
scale_shape_manual(values = c(1,2))+
labs(title = 'PCA', x='Dim1 (73.8%)', y= 'Dim2 (19.8%)')+
stat_ellipse()+
theme_bw(14)
ggplot(cbind(basic_plot$data, blups_merged_v2[, c('Trt', 'note', 'Group')]), aes(x=x, y=y, shape=Trt))+
geom_point(aes(col=Group), size=2)+
scale_shape_manual(values = c(1,2))+
labs(title = 'PCA', x='Dim1 (73.8%)', y= 'Dim2 (19.8%)')+
#stat_ellipse()+
theme_bw(14)
ggplot(cbind(basic_plot$data, blups_merged_v2[, c('Trt', 'note', 'Group')]), aes(x=x, y=y, shape=Trt))+
geom_point(aes(col=ASD), size=2)+
scale_shape_manual(values = c(1,2))+
labs(title = 'PCA', x='Dim1 (73.8%)', y= 'Dim2 (19.8%)')+
#stat_ellipse()+
theme_bw(14)
ggplot(cbind(basic_plot$data, blups_merged_v2[, c('Trt', 'note', 'Group', 'ASD')]), aes(x=x, y=y, shape=Trt))+
geom_point(aes(col=ASD), size=2)+
scale_shape_manual(values = c(1,2))+
labs(title = 'PCA', x='Dim1 (73.8%)', y= 'Dim2 (19.8%)')+
#stat_ellipse()+
theme_bw(14)
basic_plot <- fviz_pca_ind(res.pca, label= 'none')
basic_plot
ggplot(cbind(basic_plot$data, blups_merged_v2[, c('Trt', 'note', 'Group')]), aes(x=x, y=y, shape=Trt))+
geom_point(aes(col=Group), size=2)+
scale_shape_manual(values = c(1,2))+
labs(title = 'PCA', x='Dim1 (73.8%)', y= 'Dim2 (19.8%)')+
#stat_ellipse()+
theme_bw(14)
gc()
ggplot(cbind(basic_plot$data, blups_merged_v2[, c('Trt', 'note', 'Group')]), aes(x=x, y=y, shape=Trt))+
geom_point(aes(col=Group), size=2)+
scale_shape_manual(values = c(1,16))+
labs(title = 'PCA', x='Dim1 (73.8%)', y= 'Dim2 (19.8%)')+
#stat_ellipse()+
theme_bw(14)
ggplot(cbind(basic_plot$data, blups_merged_v2[, c('Trt', 'note', 'Group')]), aes(x=x, y=y, shape=Group))+
geom_point(aes(col=Trt), size=2)+
scale_shape_manual(values = c(1,16))+
labs(title = 'PCA', x='Dim1 (73.8%)', y= 'Dim2 (19.8%)')+
#stat_ellipse()+
theme_bw(14)
library(lme4)
library(reshape2)
library(rrBLUP)
library(ggplot2)
library(tidyverse)
library(zoom)
library(ggforce)
library(cowplot)
blups <- read.csv("spectra_comb_blups_v2.csv")
blups$Rep <- factor(blups$Rep)
blups$Block <- factor(blups$Block)
blups$year <- factor(blups$year)
blups$genotype <- factor(blups$genotype)
blups$note <- factor(blups$note)
blups$Trt <- factor(blups$Trt)
blups$ASD <- factor(blups$ASD)
blups$Group <- factor(blups$Group)
blups$rows <- factor(blups$rows)
blups$ranges <- factor(blups$ranges)
blups$PLOT.ID <- factor(blups$PLOT.ID)
blups$ASD  <- factor(blups$ASD)
########################   CALCULATION OF MID-PARENT HETEROSIS   #####################################
## heterosis calculation for low nitrogen condition
blups_LN <- blups[blups$Trt == "LN" & blups$Rep == 2 ,]
het <- blups_LN %>% filter(grepl(" X ", genotype))
mid_LN <- expand.grid(bands= 350:2500, genotype = het$genotype)
mid_LN$heterosis <- NA
View(blups)
for(i in 1:length(het$genotype)){
for(j in 14:length(colnames(het))){
hybrid <- as.character(het$genotype[i])
female <- strsplit(as.character(het$genotype[i]), " X ")[[1]][1]
male <- strsplit(as.character(het$genotype[i]), " X ")[[1]][2]
if(mean(blups_LN$genotype %in% c(female)) > 0 & mean(blups_LN$genotype %in% c(male) > 0 )) {
female2 <- mean(blups_LN[which(blups_LN$genotype == female ), j])
male2 <- mean(blups_LN[which(blups_LN$genotype == male ), j])
hybrid2 <- mean(blups_LN[which(blups_LN$genotype == hybrid ), j])
heterosis <- (hybrid2-mean(c(male2,female2)))/mean(c(male2,female2))*100
mid_LN[mid_LN$bands == j+336 & mid_LN$genotype == hybrid , "heterosis"] <- heterosis
print(i)
print(j)
}
else {
print("pass")
}
}
}
males <- c()
for(i in 1:length(mid_LN$genotype)){
male <- strsplit(as.character(mid_LN$genotype[i]), " X ")[[1]][2]
males<- c(males,  male)
print(i)
}
mid_LN$male <- males
mid_LN <- na.omit(mid_LN)
write_csv(mid_LN, 'mid_LN_v2.csv')
data_mid_LN <- mid_LN[mid_LN$male %in% c("B73", "Mo17"),] %>% group_by(male,bands) %>%
summarise(mean.heterosis = mean(heterosis, na.rm=TRUE), sd.heterosis = sd(heterosis, na.rm = TRUE), se.heterosis= sd(heterosis, na.rm=TRUE)/sqrt(length(heterosis)),
max = max(heterosis, na.rm = TRUE), min = min(heterosis, na.rm = TRUE))
View(mid_LN)
View(data_mid_LN)
ggplot()+
geom_line(data = data_mid_LN, aes(x=bands, y=heterosis))
ggplot()+
geom_line(data = data_mid_LN, aes(x=bands, y=mean.heterosis))
ggplot()+
geom_line(data = data_mid_LN, aes(x=bands, y=mean.heterosis, Group=genotype))
ggplot()+
geom_line(data = data_mid_LN, aes(x=bands, y=mean.heterosis, group=genotype))
ggplot()+
geom_line(data = data_mid_LN, aes(x=bands, y=mean.heterosis), group=genotype )
ggplot()+
geom_line(data = data_mid_LN, aes(x=bands, y=mean.heterosis), group=heterosis.mean )
ggplot()+
geom_line(data = data_mid_LN, aes(x=bands, y=mean.heterosis), group=mean.heterosis)
ggplot()+
geom_line(data = data_mid_LN, aes(x=bands, y=mean.heterosis), group='mean.heterosis')
## heterosis calculation for high nitrogen condition
blups_HN <- blups[blups$Trt == "HN" & blups$Rep == 2 ,]
het <- blups_HN %>% filter(grepl(" X ", genotype))
mid_HN <- expand.grid(bands= 350:2500, genotype = het$genotype)
mid_HN$heterosis <- NA
for(i in 1:length(het$genotype)){
for(j in 13:length(colnames(het))){
hybrid <- as.character(het$genotype[i])
female <- strsplit(as.character(het$genotype[i]), " X ")[[1]][1]
male <- strsplit(as.character(het$genotype[i]), " X ")[[1]][2]
if(mean(blups_HN$genotype %in% c(female)) > 0 & mean(blups_HN$genotype %in% c(male) > 0 )) {
female2 <- mean(blups_HN[which(blups_HN$genotype == female ), j])
male2 <- mean(blups_HN[which(blups_HN$genotype == male ), j])
hybrid2 <- mean(blups_HN[which(blups_HN$genotype == hybrid ), j])
heterosis <- (hybrid2-mean(c(male2,female2)))/mean(c(male2,female2))*100
mid_HN[mid_HN$bands == j+337 & mid_HN$genotype == hybrid , "heterosis"] <- heterosis
print(i)
print(j)
}
else
print("pass")
}
}
males <- c()
for(i in 1:length(mid_HN$genotype)){
male <- strsplit(as.character(mid_HN$genotype[i]), " X ")[[1]][2]
males<- c(males,  male)
print(i)
}
mid_HN$male <- males
mid_HN <- na.omit(mid_HN)
write_csv(mid_HN, 'mid_HN.csv')
data_mid_HN <- mid_HN[mid_HN$male %in% c("B73", "Mo17"),] %>% group_by(male,bands) %>%
summarise(mean.heterosis = mean(heterosis, na.rm=TRUE), sd.heterosis = sd(heterosis, na.rm = TRUE), se.heterosis= sd(heterosis, na.rm=TRUE)/sqrt(length(heterosis)),
max = max(heterosis, na.rm = TRUE), min = min(heterosis, na.rm = TRUE))
data_mid_HN$Trt <- c(rep('HN', length(data_mid_HN$bands)))
data_mid_HN$Htype <- c(rep('mid', length(data_mid_HN$bands)))
data_mid_LN$Trt <- c(rep('LN', length(data_mid_LN$bands)))
data_mid_LN$Htype <- c(rep('mid', length(data_mid_LN$bands)))
plot_data <- data_mid_HN %>% full_join(data_mid_LN) %>% full_join(data_better_HN) %>% full_join(data_better_LN) %>% full_join(data_low_HN) %>%
full_join(data_low_LN)
sub_plot_data = plot_data[plot_data$Htype == 'mid',]
theme_set(theme_bw(10))
p6 <- ggplot(data=sub_plot_data, aes(x=bands, group= male)) +
geom_line(data= sub_plot_data[sub_plot_data$Trt == 'HN',], aes( x= bands,y=mean.heterosis, linetype=male, color= Trt),size = 0.7)+
geom_ribbon(data= sub_plot_data[sub_plot_data$Trt == 'HN',], aes(ymin=mean.heterosis-se.heterosis , ymax=mean.heterosis+se.heterosis),alpha=0.2)+
geom_line(data= sub_plot_data[sub_plot_data$Trt == 'LN',], aes( x= bands,y=mean.heterosis,linetype=male, color = Trt), size = 0.7)+
geom_ribbon(data= sub_plot_data[sub_plot_data$Trt == 'LN',], aes(ymin=mean.heterosis-se.heterosis , ymax=mean.heterosis+se.heterosis),alpha=0.2)+
scale_x_continuous(breaks =c(350, 550, 710, 1445,1890, 2020, 2410, 2500))+
theme(axis.text.x = element_text(angle=45))+
labs(title = 'Mid-parent Heterosis under HN and LN conditions', caption = '**Envelopes represent 1 se from the mean')
p6 +
annotate('rect', xmin=350, xmax=750, ymin=-10, ymax=10, alpha= 0.1, fill='blue')+
annotate('rect', xmin=750, xmax=2500, ymin=-10, ymax=10, alpha= 0.1, fill='yellow')+
annotate('text', x=550, y=9, label= 'Environmentally \n Driven')+
annotate('text', x=1500, y=9, label = 'Genetically Driven')+
geom_vline(xintercept = 550, size=0.2)+
geom_vline(xintercept = 710, size=0.2)+
geom_vline(xintercept = 1445, size=0.2)+
geom_vline(xintercept = 1890, size=0.2)+
geom_vline(xintercept = 2020, size=0.2)+
geom_vline(xintercept = 2410, size=0.2)
View(blups)
View(data)
basic_plot <- fviz_pca_ind(res.pca, label= 'none')
library(FactoMineR)
library(ggplot2)
library(factoextra)
library(tidyverse)
ggplot(cbind(basic_plot$data, blups_merged_v2[, c('Trt', 'note', 'Group')]), aes(x=x, y=y, shape=Group))+
geom_point(aes(col=Trt), size=2)+
scale_shape_manual(values = c(1,16))+
labs(title = 'PCA', x='Dim1 (73.8%)', y= 'Dim2 (19.8%)')+
#stat_ellipse()+
theme_bw(14)
ggplot(cbind(basic_plot$data, blups_merged_v2[, c('Trt', 'note', 'Group', 'ASD')]), aes(x=x, y=y, shape=Group))+
geom_point(aes(col=ASD), size=2)+
scale_shape_manual(values = c(1,16))+
labs(title = 'PCA', x='Dim1 (73.8%)', y= 'Dim2 (19.8%)')+
#stat_ellipse()+
theme_bw(14)
ggplot(cbind(basic_plot$data, blups_merged_v2[, c('Trt', 'note', 'Group')]), aes(x=x, y=y, shape=Group))+
geom_point(aes(col=Trt), size=2)+
scale_shape_manual(values = c(1,16))+
labs(title = 'PCA', x='Dim1 (73.8%)', y= 'Dim2 (19.8%)')+
#stat_ellipse()+
theme_bw(14)
data_checks <- data[data$genotype %in% c('B73', 'Mo17', 'B73 X Mo17'),]
ggplot(data = data)+
geom_line(aes(wavelength, value, group=genotype, color=Trt), size=0.1)+
labs(title = 'Leaf spectra_comb (BLUPS)', x='bands', y='reflectance')+
theme_bw()
gc()
ggplot(data = data_checks)+
geom_line(aes(wavelength, value, group=genotype, color=Trt), size=0.1)+
labs(title = 'Leaf spectra_comb (BLUPS)', x='bands', y='reflectance')+
theme_bw()
View(data_checks)
ggplot() +
geom_line(data_checks=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= new_GID, color='LN'), size=0.1)+
geom_line(data_checks=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= new_GID, color='HN'), size=0.1)+
scale_color_manual(name='Treatment',  values = c('HN'= 'green', 'LN' = 'yellow'))
ggplot() +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= new_GID, color='LN'), size=0.1)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= new_GID, color='HN'), size=0.1)+
scale_color_manual(name='Treatment',  values = c('HN'= 'green', 'LN' = 'yellow'))
ggplot() +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= new_GID, color='LN'), size=0.5)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= new_GID, color='HN'), size=0.5)+
scale_color_manual(name='Treatment',  values = c('HN'= 'green', 'LN' = 'yellow'))
ggplot() +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= new_GID, color='LN'), size=0.5)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= new_GID, color='HN'), size=0.5)+
scale_color_manual(name='Treatment',  values = c('HN'= 'green', 'LN' = 'red'))
ggplot() +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= new_GID, color='LN'), size=0.4)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= new_GID, color='HN'), size=0.4)+
scale_color_manual(name='Treatment',  values = c('HN'= 'green', 'LN' = 'red'))
ggplot() +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= genotype, color='LN'), size=0.4)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= genotype, color='HN'), size=0.4)+
scale_color_manual(name='Treatment',  values = c('HN'= 'green', 'LN' = 'red'))
ggplot() +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= genotype, color='LN'), size=0.4)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= genotype, color='HN'), size=0.4)+
scale_color_manual(name='Treatment',  values = c('HN'= 'green', 'LN' = 'red'))+
scale_shape_manual(name= 'genotype')
ggplot() +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= genotype, color='LN', shape=genotype), size=0.4)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= genotype, color='HN'), size=0.4)+
scale_color_manual(name='Treatment',  values = c('HN'= 'green', 'LN' = 'red'))+
scale_shape_manual(name= 'genotype')
ggplot(aes(shape=genotype)) +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= genotype, color='LN'), size=0.4)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= genotype, color='HN'), size=0.4)+
scale_color_manual(name='Treatment',  values = c('HN'= 'green', 'LN' = 'red'))+
scale_shape_manual(name= 'genotype')
ggplot(data=data_checks,aes(shape=genotype)) +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= genotype, color='LN'), size=0.4)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= genotype, color='HN'), size=0.4)+
scale_color_manual(name='Treatment',  values = c('HN'= 'green', 'LN' = 'red'))+
scale_shape_manual(name= 'genotype')
ggplot(data=data_checks,aes(shape=genotype)) +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= genotype, color='LN'), size=0.4)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= genotype, color='HN'), size=0.4)+
scale_color_manual(name='Treatment',  values = c('HN'= 'green', 'LN' = 'red'))
ggplot(data=data_checks,aes(linetype=genotype)) +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= genotype, color='LN'), size=0.4)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= genotype, color='HN'), size=0.4)+
scale_color_manual(name='Treatment',  values = c('HN'= 'green', 'LN' = 'red'))
ggplot(data=data_checks,aes(color=genotype)) +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= genotype, shape='LN'), size=0.4)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= genotype, shape='HN'), size=0.4)+
scale_shape_manual(name='Treatment',  values = c('HN'= 'dashed', 'LN' = 'solid'))
ggplot(data=data_checks,aes(color=genotype)) +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= genotype, linetype='LN'), size=0.4)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= genotype, lintype='HN'), size=0.4)+
scale_shape_manual(name='Treatment',  values = c('HN'= 'dashed', 'LN' = 'solid'))
ggplot(data=data_checks,aes(color=genotype)) +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= genotype, linetype='LN'), size=0.4)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= genotype, linetype='HN'), size=0.4)+
scale_shape_manual(name='Treatment',  values = c('HN'= 'dashed', 'LN' = 'solid'))
data_checks <- data[data$genotype %in% c('B73', 'Mo17'),]
ggplot(data=data_checks,aes(color=genotype)) +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= genotype, linetype='LN'), size=0.4)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= genotype, linetype='HN'), size=0.4)+
scale_shape_manual(name='Treatment',  values = c('HN'= 'dashed', 'LN' = 'solid'))
ggplot(data=data_checks,aes(color=genotype)) +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= genotype, linetype='LN'), size=0.4)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= genotype, linetype='HN'), size=0.4)+
scale_shape_manual(name='Treatment',  values = c('HN'= 'dashed', 'LN' = 'solid'))
View(data_low_LN)
data_others <- data[data$genotype %in% -c('B73', 'Mo17') & data$Group != 'Hybrid', ]
data_others <- data[data$genotype !%in% c('B73', 'Mo17') & data$Group != 'Hybrid', ]
data_others <- data[data$genotype %in% !c('B73', 'Mo17') & data$Group != 'Hybrid', ]
data_others <- data[!(data$genotype %in% c('B73', 'Mo17')) & data$Group != 'Hybrid', ]
data_others
View(data_others)
data_others_grp <- data_others %>% group_by(wavelength, Trt) %>% summarise(mean_ref = mean(value, na.rm= TRUE))
View(data_others_grp)
data_others_grp <- data_others %>% group_by(wavelength, Trt) %>% summarise(mean.ref = mean(value, na.rm= TRUE), se.ref= sd(value, na.rm=TRUE)/sqrt(length(value)))
p_parents <- ggplot(data=data_checks,aes(color=genotype)) +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= genotype, linetype='LN'), size=0.4)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= genotype, linetype='HN'), size=0.4)+
scale_shape_manual(name='Treatment',  values = c('HN'= 'dashed', 'LN' = 'solid'))
p_parents +
ggplot(data= data_others_grp)+
geom_line(aes(x=wavelength, y=mean.ref ))
p_parents +
geom_line(data= data_others_grp, aes(x=wavelength, y=mean.ref ))
p_parents +
geom_line(data= data_others_grp, aes(x=wavelength, y=mean.ref ))
p_parents <- ggplot(data=data_checks,aes(color=genotype)) +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= genotype, linetype='LN'), size=0.4)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= genotype, linetype='HN'), size=0.4)+
scale_shape_manual(name='Treatment',  values = c('HN'= 'dashed', 'LN' = 'solid'))
p_parents +
geom_line(data= data_others_grp, aes(x=wavelength, y=mean.ref ))
p_inb <- ggplot(data= data_others_grp) +
geom_line(data=data_others_grp[data_others_grp$Trt == 'LN'], aes(wavelength, value))
p_inb <- ggplot() +
geom_line(data=data_others_grp[data_others_grp$Trt == 'LN'], aes(wavelength, value))
p_inb <- ggplot() +
geom_line(data=data_others_grp[data_others_grp$Trt == 'LN'], aes(wavelength, mean.ref))
p_inb <- ggplot() +
geom_line(data=data_others_grp[data_others_grp$Trt == 'LN' , ], aes(wavelength, mean.ref))
p_inb
p_inb <- ggplot() +
geom_line(data=data_others_grp[data_others_grp$Trt == 'LN' , ], aes(wavelength, mean.ref))+
geom_line(data=data_others_grp[data_others_grp$Trt == 'HN' , ], aes(wavelength, mean.ref))
p_inb
data_others_grp <- data_others %>% group_by(wavelength, Trt, male) %>% summarise(mean.ref = mean(value, na.rm= TRUE), se.ref= sd(value, na.rm=TRUE)/sqrt(length(value)))
p_inb +p_parents
ggplot_add(p_inb +p_parents)
ggplot_add(p_inb ,p_parents)
hybrids <- data %>% filter(grepl(' X ', genotype)) #applying a filter for the genotypes containing ' X '
View(data)
data <- data %>% mutate(het_grp = NA, .before=note) # adding a new column for heterotic groups
for (i in 1:length(hybrids$genotype)){
id <- hybrids$genotype[i]
inbred <- strsplit(as.character(id), ' X ')[[1]][1]
if(strsplit(as.character(id), ' X ')[[1]][2] == 'B73'){
data[data$genotype == inbred, "het_grp"] <- 'NSS'
}
else if(strsplit(as.character(id), ' X ')[[1]][2] == 'Mo17'){
blues[blues$genotype == inbred, "het_grp"] <- 'SS'
}
else if(id == 'B73'){
blues[blues$genotype == id, "het_grp"] <- 'NSS'
}
else {
blues[blues$genotype == inbred, "het_grp"] <- 'other'
}
}
data <- data %>% mutate(het_grp = NA, .before=note) # adding a new column for heterotic groups
hybrids <- data %>% filter(grepl(' X ', genotype)) #applying a filter for the genotypes containing ' X '
for (i in 1:length(hybrids$genotype)){
id <- hybrids$genotype[i]
inbred <- strsplit(as.character(id), ' X ')[[1]][1]
if(strsplit(as.character(id), ' X ')[[1]][2] == 'B73'){
data[data$genotype == inbred, "het_grp"] <- 'NSS'
}
else if(strsplit(as.character(id), ' X ')[[1]][2] == 'Mo17'){
data[data$genotype == inbred, "het_grp"] <- 'SS'
}
else if(id == 'B73'){
data[data$genotype == id, "het_grp"] <- 'NSS'
}
else {
data[data$genotype == inbred, "het_grp"] <- 'other'
}
}
blups_merged_v2 <- blups_merged_v2 %>% mutate(het_grp = NA, .before=note) # adding a new column for heterotic groups
hybrids <- blups_merged_v2 %>% filter(grepl(' X ', genotype)) #applying a filter for the genotypes containing ' X '
for (i in 1:length(hybrids$genotype)){
id <- hybrids$genotype[i]
inbred <- strsplit(as.character(id), ' X ')[[1]][1]
if(strsplit(as.character(id), ' X ')[[1]][2] == 'B73'){
data[data$genotype == inbred, "het_grp"] <- 'NSS'
}
else if(strsplit(as.character(id), ' X ')[[1]][2] == 'Mo17'){
data[data$genotype == inbred, "het_grp"] <- 'SS'
}
else if(id == 'B73'){
data[data$genotype == id, "het_grp"] <- 'NSS'
}
else {
data[data$genotype == inbred, "het_grp"] <- 'other'
}
}
data
blups_merged_v2 <- blups_merged_v2 %>% mutate(het_grp = NA, .before=note) # adding a new column for heterotic groups
hybrids <- blups_merged_v2 %>% filter(grepl(' X ', genotype)) #applying a filter for the genotypes containing ' X '
for (i in 1:length(hybrids$genotype)){
id <- hybrids$genotype[i]
inbred <- strsplit(as.character(id), ' X ')[[1]][1]
if(strsplit(as.character(id), ' X ')[[1]][2] == 'B73'){
blups_merged_v2[blups_merged_v2$genotype == inbred, "het_grp"] <- 'NSS'
}
else if(strsplit(as.character(id), ' X ')[[1]][2] == 'Mo17'){
blups_merged_v2[blups_merged_v2$genotype == inbred, "het_grp"] <- 'SS'
}
else if(id == 'B73'){
blups_merged_v2[blups_merged_v2$genotype == id, "het_grp"] <- 'NSS'
}
else {
blups_merged_v2[blups_merged_v2$genotype == inbred, "het_grp"] <- 'other'
}
}
View(blups_merged)
View(blups_merged_v2)
################3####### Adding SS NSS information on Blup_merged_v2######################
blups_merged_v2 <- blups_merged_v2 %>% mutate(het_grp = NA, .before=note) # adding a new column for heterotic groups
hybrids <- blups_merged_v2 %>% filter(grepl(' X ', genotype)) #applying a filter for the genotypes containing ' X '
hybrids
View(hybrids)
for (i in 1:length(hybrids$genotype)){
id <- hybrids$genotype[i]
inbred <- strsplit(as.character(id), ' X ')[[1]][1]
if(strsplit(as.character(id), ' X ')[[1]][2] == 'B73'){
blups_merged_v2[blups_merged_v2$genotype == inbred, "het_grp"] <- 'NSS'
}
else if(strsplit(as.character(id), ' X ')[[1]][2] == 'Mo17'){
blups_merged_v2[blups_merged_v2$genotype == inbred, "het_grp"] <- 'SS'
}
else if(id == 'B73'){
blups_merged_v2[blups_merged_v2$genotype == id, "het_grp"] <- 'NSS'
}
else {
blups_merged_v2[blups_merged_v2$genotype == inbred, "het_grp"] <- 'other'
}
}
data <-melt(blups_merged_v2, id.vars = c('PLOT.ID','new_GID', 'het_grp', 'genotype','rows', 'ranges', 'Block' ,'Rep', 'Trt', 'year', 'note', 'Group', 'Calibration', 'ASD'))
a <- sapply(strsplit(as.character(data$variable), '[.]'), '[[', 1)
data$wavelength <- as.numeric(substr(a,2,5))
View(data)
data_checks <- data[data$genotype %in% c('B73', 'Mo17'),]  ## only the genotypes B73 and Mo17
data_others <- data[!(data$genotype %in% c('B73', 'Mo17')) & data$Group != 'Hybrid', ]  ## only the inbreds except B73 and Mo17
data_others_grp <- data_others %>% group_by(wavelength, Trt, het_grp) %>% summarise(mean.ref = mean(value, na.rm= TRUE), se.ref= sd(value, na.rm=TRUE)/sqrt(length(value)))
View(data_others_grp)
p_inb <- ggplot() +
geom_line(data=data_others_grp[data_others_grp$Trt == 'LN' , ], aes(wavelength, mean.ref, color= het_grp))+
geom_line(data=data_others_grp[data_others_grp$Trt == 'HN' , ], aes(wavelength, mean.ref, color=het_grp))
p_inb
p_parents <- ggplot(data=data_checks,aes(color=genotype)) +
geom_line(data=data_checks[which(data_checks$Trt == 'LN'),],aes(wavelength, value, group= genotype, linetype='LN'), size=0.4)+
geom_line(data=data_checks[which(data_checks$Trt == 'HN'),], aes(wavelength, value, group= genotype, linetype='HN'), size=0.4)+
scale_shape_manual(name='Treatment',  values = c('HN'= 'dashed', 'LN' = 'solid'))
p_parents
p_b73 <- ggplot(data= data_checks[data_checks$genotype == 'B73' , ])+
geom_line(aes(wavelength, value))
p_b73
p_b73 <- ggplot(data= data_checks[data_checks$genotype == 'B73' , ] , group = Trt)+
geom_line(aes(wavelength, value))
p_b73
p_b73 <- ggplot(data= data_checks[data_checks$genotype == 'B73' , ])+
geom_line(aes(wavelength, value , group = Trt))
p_b73
p_NSS <- gplot(data= data_others_grp[data_others_grp$het_grp == 'NSS',])+
geom_line(aes(wavelength, value , group= Trt))
p_NSS
p_NSS <- gplot(data= data_others_grp[data_others_grp$het_grp == 'NSS',])+
geom_line(aes(wavelength, value , group= Trt))
p_NSS <- ggplot(data= data_others_grp[data_others_grp$het_grp == 'NSS',])+
geom_line(aes(wavelength, value , group= Trt))
p_NSS
p_NSS <- ggplot(data= data_others_grp[data_others_grp$het_grp == 'NSS',])+
geom_line(aes(mean.ref, value , group= Trt))
p_NSS
p_NSS <- ggplot(data= data_others_grp[data_others_grp$het_grp == 'NSS',])+
geom_line(aes(wavelength, mean.ref , group= Trt))
p_NSS
p_NSS <- ggplot(data= na.omit(data_others_grp[data_others_grp$het_grp == 'NSS',]))+
geom_line(aes(wavelength, mean.ref , group= Trt))
p_NSS
p_NSS <- ggplot(data= na.omit(data_others_grp[data_others_grp$het_grp == 'NSS',]))+
geom_line(aes(wavelength, mean.ref , group= Trt))
p_NSS
data_grp <- data %>% group_by(Genotype,wavelength, Trt, het_grp)
data_grp <- data %>% group_by(genotype,wavelength, Trt, het_grp)
data_grp
View(data_grp)
data_grp <- data %>% group_by(genotype,wavelength, Trt, het_grp) %>% summarise(mean.ref = mean(value, na.rm= TRUE), se.ref= sd(value, na.rm=TRUE)/sqrt(length(value))))
data_grp <- data %>% group_by(genotype, wavelength, Trt, het_grp) %>% summarise(mean.ref = mean(value, na.rm= TRUE), se.ref= sd(value, na.rm=TRUE)/sqrt(length(value)))
ggplot()+
geom_line(data=data[data_grp$genotype == 'B73', ], aes(wavelength, mean.ref, group=Trt))
ggplot()+
geom_line(data=data_grp[data_grp$genotype == 'B73', ], aes(wavelength, mean.ref, group=Trt))
ggplot()+
geom_line(data=data_grp[data_grp$genotype == 'B73', ], aes(wavelength, mean.ref, color=Trt))
ggplot()+
geom_line(data=data_grp[data_grp$genotype == 'B73', ], aes(wavelength, mean.ref, color=Trt))+
geom_line(data=data_grp[data_grp$het_grp == 'NSS',], aes(wavelength, mean.ref, color=Trt))
ggplot()+
geom_line(data=data_grp[data_grp$het_grp == 'NSS',], aes(wavelength, mean.ref, color=Trt))
ggplot()+
geom_line(data=data_grp[data_grp$genotype == 'B73', ], aes(wavelength, mean.ref, color=Trt))+
geom_line(data=na.omit(data_grp[data_grp$het_grp == 'NSS',]), aes(wavelength, mean.ref, color=Trt))
ggplot()+
geom_line(data=data_grp[data_grp$genotype == 'B73', ], aes(wavelength, mean.ref, color=Trt))+
geom_line(data=data_grp[data_grp$het_grp == 'NSS',], aes(wavelength, mean.ref, color=Trt))
