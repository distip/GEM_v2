plt_blups <- ggplot(data=data, aes(x=wavelength, group= note)) +
geom_line(aes(y=mean.ref, color=note), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=note),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blups
data <- blues_plot[blues_plot$Trt == 'HN',] %>% group_by(wavelength,note) %>%
summarise(mean.ref = mean(value, na.rm=TRUE), sd.ref = sd(value, na.rm = TRUE), se.ref= sd(value, na.rm=TRUE)/sqrt(length(value)),
max = max(value, na.rm = TRUE), min = min(value, na.rm = TRUE))
ggplot(blues_merged, aes(rows, ranges, color=X730)) +
geom_point(size=1.3) +
scale_y_continuous(name='ranges', limits = c(1,13))+
geom_rect( aes(xmin=0.4, xmax = 51, ymin = 7.5, ymax = 12.5), fill=NA, colour='red')+
#annotate('rect', xmin=0, xmax = 50, ymin = 7.5, ymax = 12.5, alpha= .1)+
facet_wrap(~Trt)+
scale_colour_viridis() +
labs(title = 'BLUEs Corrected \n genotype+(1|ASD)+(1|Block:Rep)', caption = ' Blocks 1 and 4 = + N , 2 and 3 = -N\nred rectangles are the hybrids ')+
theme_classic()
plt_blues <- ggplot(data=data, aes(x=wavelength, group= note)) +
geom_line(aes(y=mean.ref, color=note), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=note),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
data <- blues_plot[blues_plot$Trt == 'HN',] %>% group_by(wavelength,note) %>%
summarise(mean.ref = mean(value, na.rm=TRUE), sd.ref = sd(value, na.rm = TRUE), se.ref= sd(value, na.rm=TRUE)/sqrt(length(value)),
max = max(value, na.rm = TRUE), min = min(value, na.rm = TRUE))
plt_blues <- ggplot(data=data, aes(x=wavelength, group= note)) +
geom_line(aes(y=mean.ref, color=note), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=note),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
blues_plot <- melt(blues, id.vars = c('PLOT.ID', 'genotype','rows', 'ranges', 'Block' ,'Rep', 'Trt', 'year', 'note', 'Calibration', 'ASD', 'Group'))
a <- sapply(strsplit(as.character(blues_plot$variable), '[.]'), '[[', 1)
blues_plot$wavelength <- as.numeric(substr(a,2,5))
blues_plot$wavelength <- as.numeric(blues_plot$wavelength)
data <- blues_plot[blues_plot$Trt == 'HN',] %>% group_by(wavelength,note) %>%
summarise(mean.ref = mean(value, na.rm=TRUE), sd.ref = sd(value, na.rm = TRUE), se.ref= sd(value, na.rm=TRUE)/sqrt(length(value)),
max = max(value, na.rm = TRUE), min = min(value, na.rm = TRUE))
plt_blues <- ggplot(data=data, aes(x=wavelength, group= note)) +
geom_line(aes(y=mean.ref, color=note), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=note),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
blues <- read_csv('spectra_blues.csv')
blues <- as.data.frame(blues)
blues <- blues %>% select(-contains(c('.x', '.y', '.z')))
blues <- blues[ , colSums(is.na(blues))==0]
str(blues)
str(blues)
blues <- read_csv('spectra_blues.csv')
blues <- as.data.frame(blues)
blues <- blues %>% select(-contains(c('.x', '.y', '.z')))
blues <- blues[ , colSums(is.na(blues))==0]
str(blues)
blues$genotype <- as.factor(blues$genotype)
blues$PLOT.ID <- as.factor(blues$PLOT.ID)
blues$rows <- as.factor(blues$rows)
blues$ranges <- as.factor(blues$ranges)
blues$Block <- as.factor(blues$Block)
blues$Rep <- as.factor(blues$Rep)
blues$Trt <- as.factor(blues$Trt)
blues$year <- as.factor(blues$year)
blues$note <-as.factor(blues$note)
blues$Calibration <- as.factor(blues$Calibration)
blues$ASD <- as.factor(blues$ASD)
blues <- read_csv('spectra_blues.csv')
blues <- as.data.frame(blues)
View(blues)
str(blues)
blues$genotype <- as.factor(blues$genotype)
blues$PLOT.ID <- as.factor(blues$PLOT.ID)
blues$rows <- as.factor(blues$rows)
blues$ranges <- as.factor(blues$ranges)
blues$Block <- as.factor(blues$Block)
blues$Rep <- as.factor(blues$Rep)
blues$Trt <- as.factor(blues$Trt)
blues$year <- as.factor(blues$year)
blues$note <-as.factor(blues$note)
blues$Calibration <- as.factor(blues$Calibration)
blues$ASD <- as.factor(blues$ASD)
blues_plot <- melt(blues, id.vars = c('PLOT.ID', 'genotype','rows', 'ranges', 'Block' ,'Rep', 'Trt', 'year', 'note', 'Calibration', 'ASD', 'Group'))
a <- sapply(strsplit(as.character(blues_plot$variable), '[.]'), '[[', 1)
blues_plot$wavelength <- as.numeric(substr(a,2,5))
blues_plot$wavelength <- as.numeric(blues_plot$wavelength)
data <- blues_plot[blues_plot$Trt == 'HN',] %>% group_by(wavelength,note) %>%
summarise(mean.ref = mean(value, na.rm=TRUE), sd.ref = sd(value, na.rm = TRUE), se.ref= sd(value, na.rm=TRUE)/sqrt(length(value)),
max = max(value, na.rm = TRUE), min = min(value, na.rm = TRUE))
plt_blues <- ggplot(data=data, aes(x=wavelength, group= note)) +
geom_line(aes(y=mean.ref, color=note), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=note),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
plt_blues <- ggplot(data=data, aes(x=wavelength, group= Group)) +
geom_line(aes(y=mean.ref, color=note), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=note),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
data <- blues_plot[blues_plot$Trt == 'HN',] %>% group_by(wavelength,note,Group) %>%
summarise(mean.ref = mean(value, na.rm=TRUE), sd.ref = sd(value, na.rm = TRUE), se.ref= sd(value, na.rm=TRUE)/sqrt(length(value)),
max = max(value, na.rm = TRUE), min = min(value, na.rm = TRUE))
plt_blues <- ggplot(data=data, aes(x=wavelength, group= Group)) +
geom_line(aes(y=mean.ref, color=note), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=note),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
plt_blues <- ggplot(data=data, aes(x=wavelength, group= Group)) +
geom_line(aes(y=mean.ref, color=note), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=Group),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
plt_blues <- ggplot(data=data, aes(x=wavelength, group= Group)) +
geom_line(aes(y=mean.ref, color=Group), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=Group),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
plt_blues <- ggplot(data=data, aes(x=wavelength, group= Group)) +
geom_line(aes(y=mean.ref, color=Group), size = 0.6)+
#geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=Group),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
plt_blues <- ggplot(data=data, aes(x=wavelength, group= Group)) +
geom_line(aes(y=mean.ref, color=Group), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=Group),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
data <- blues_plot[blues_plot$Trt == 'HN',] %>% group_by(genotype,wavelength,note,Group) %>%
summarise(mean.ref = mean(value, na.rm=TRUE), sd.ref = sd(value, na.rm = TRUE), se.ref= sd(value, na.rm=TRUE)/sqrt(length(value)),
max = max(value, na.rm = TRUE), min = min(value, na.rm = TRUE))
plt_blues <- ggplot(data=data, aes(x=wavelength, group= Group)) +
geom_line(aes(y=mean.ref, color=Group), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=Group),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
data <- blues_plot[blues_plot$Trt == 'HN',] %>% group_by(genotype,wavelength,note,Group) %>%
summarise(mean.ref = mean(value, na.rm=TRUE), sd.ref = sd(value, na.rm = TRUE), se.ref= sd(value, na.rm=TRUE)/sqrt(length(value)),
max = max(value, na.rm = TRUE), min = min(value, na.rm = TRUE))
data <- blues_plot[blues_plot$Trt == 'HN',] %>% group_by(wavelength,note,Group) %>%
summarise(mean.ref = mean(value, na.rm=TRUE), sd.ref = sd(value, na.rm = TRUE), se.ref= sd(value, na.rm=TRUE)/sqrt(length(value)),
max = max(value, na.rm = TRUE), min = min(value, na.rm = TRUE))
plt_blues <- ggplot(data=data, aes(x=wavelength, group= Group)) +
geom_line(aes(y=mean.ref, color=Group), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=Group),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
data <- blues_plot[blues_plot$Trt == 'LN',] %>% group_by(wavelength,note,Group) %>%
summarise(mean.ref = mean(value, na.rm=TRUE), sd.ref = sd(value, na.rm = TRUE), se.ref= sd(value, na.rm=TRUE)/sqrt(length(value)),
max = max(value, na.rm = TRUE), min = min(value, na.rm = TRUE))
plt_blues <- ggplot(data=data, aes(x=wavelength, group= Group)) +
geom_line(aes(y=mean.ref, color=Group), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=Group),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
plt_blues <- ggplot(data=data, aes(x=wavelength, group= Group)) +
geom_line(aes(y=mean.ref, color=Group), size = 0.6)+
#geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=Group),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
data <- blues_plot %>% group_by(wavelength,note,Group) %>%
summarise(mean.ref = mean(value, na.rm=TRUE), sd.ref = sd(value, na.rm = TRUE), se.ref= sd(value, na.rm=TRUE)/sqrt(length(value)),
max = max(value, na.rm = TRUE), min = min(value, na.rm = TRUE))
plt_blues <- ggplot(data=data, aes(x=wavelength, group= Group)) +
geom_line(aes(y=mean.ref, color=Group), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=Group),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
View(blues_plot)
View(data)
plt_blues <- ggplot(data=data, aes(x=wavelength, group= note)) +
geom_line(aes(y=mean.ref, color=note), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=note),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
plt_blues <- ggplot(data=data, aes(x=wavelength, group= note)) +
geom_line(aes(y=mean.ref, color=note), size = 0.6)+
#geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=note),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
data <- blues_plot %>% group_by(wavelength,Group) %>%
summarise(mean.ref = mean(value, na.rm=TRUE), sd.ref = sd(value, na.rm = TRUE), se.ref= sd(value, na.rm=TRUE)/sqrt(length(value)),
max = max(value, na.rm = TRUE), min = min(value, na.rm = TRUE))
plt_blues <- ggplot(data=data, aes(x=wavelength, group= Group)) +
geom_line(aes(y=mean.ref, color=Group), size = 0.6)+
#geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=note),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
plt_blues <- ggplot(data=data, aes(x=wavelength, group= Group)) +
geom_line(aes(y=mean.ref, color=Group), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=note),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
plt_blues <- ggplot(data=data, aes(x=wavelength, group= Group)) +
geom_line(aes(y=mean.ref, color=Group), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=Group),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
plt_blues <- ggplot(data=data, aes(x=wavelength, group= note)) +
geom_line(aes(y=mean.ref, color=note), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=note),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
data <- blues_plot %>% group_by(wavelength,note) %>%
summarise(mean.ref = mean(value, na.rm=TRUE), sd.ref = sd(value, na.rm = TRUE), se.ref= sd(value, na.rm=TRUE)/sqrt(length(value)),
max = max(value, na.rm = TRUE), min = min(value, na.rm = TRUE))
plt_blues <- ggplot(data=data, aes(x=wavelength, group= note)) +
geom_line(aes(y=mean.ref, color=note), size = 0.6)+
geom_ribbon(aes(ymin=mean.ref-se.ref , ymax=mean.ref+se.ref , fill=note),alpha=0.3)+
labs(title = 'Leaf Spectra inbred vs hybrids under HN', caption = '**Envelopes represent 1 sd from the mean')+
theme_bw()
plt_blues
gc()
res.pca <- prcomp(blups[blups$Group== 'Hybrid',15:length(colnames(blups))], scale = FALSE)
basic_plot <- fviz_pca_ind(res.pca, label= 'none')
ggplot(cbind(basic_plot$data, blups[blups$Group== 'Hybrid',c('Trt', 'Group', 'male')]), aes(x=x, y=y, shape=Group, col = male ))+
geom_point(size=2)+
labs(title = 'PCA', x='Dim1 (82.7%)', y= 'Dim2 (12.4%)')+
#stat_ellipse(type= 't')+
theme_bw(14)
ggplot(cbind(basic_plot$data, blups[blups$Group== 'Hybrid',c('Trt', 'Group', 'male'),]), aes(x=x, y=y, shape=Group, col = male ))+
geom_point(size=2)+
labs(title = 'PCA', x='Dim1 (82.7%)', y= 'Dim2 (12.4%)')+
#stat_ellipse(type= 't')+
theme_bw(14)
View(blups)
spectra2  <-  spectra %>% drop_na()
library(FactoMineR)
library(ggplot2)
library(factoextra)
library(tidyverse)
spectra2  <-  spectra %>% drop_na()
spectra <- subset(spectra, select = -c(X, Unnamed..0))
res.pca <- prcomp(spectra2[, 12:length(colnames(spectra2))], scale = FALSE)
fviz_pca_ind(res.pca, geom="point")
fviz_pca_ind(res.pca, label="none", habillage=spectra2$ASD)
#### PCA of Raw Spectra #####
spectra <- read.csv("Raw_spectrum_merged")
#### PCA of Raw Spectra #####
spectra <- read.csv("Raw_spectrum_merged")
spectra$Rep <- factor(spectra$Rep)
spectra$Block <- factor(spectra$Block)
spectra$year <- factor(spectra$year)
spectra$genotype <- factor(spectra$genotype)
spectra$note <- factor(spectra$note)
spectra$Trt <- factor(spectra$Trt)
spectra$ASD <- factor(spectra$ASD)
spectra2  <-  spectra %>% drop_na()
spectra <- subset(spectra, select = -c(X, Unnamed..0))
View(spectra)
res.pca <- prcomp(spectra2[, 13:length(colnames(spectra2))], scale = FALSE)
spectra2  <-  spectra %>% drop_na()
res.pca <- prcomp(spectra2[, 13:length(colnames(spectra2))], scale = FALSE)
fviz_pca_ind(res.pca, geom="point")
fviz_pca_ind(res.pca, label="none", habillage=spectra2$ASD)
ggplot(cbind(basic_plot$data, spectra2[, c('Trt', 'ASD', 'Group')]), aes(x=x, y=y, shape=Trt, col=note))+
geom_point(size=2)+
labs(title = 'PCA', x='Dim1 (77.2%)', y= 'Dim2 (10.9%)')+
#stat_ellipse()+
theme_bw(14)
basic_plot <- fviz_pca_ind(res.pca, label= 'none')
basic_plot
ggplot(cbind(basic_plot$data, spectra2[, c('Trt', 'ASD', 'Group')]), aes(x=x, y=y, shape=Trt, col=ASD))+
geom_point(size=2)+
labs(title = 'PCA', x='Dim1 (77.2%)', y= 'Dim2 (10.9%)')+
#stat_ellipse()+
theme_bw(14)
ggplot(cbind(basic_plot$data, spectra2[, c('Trt', 'ASD', 'Group')]), aes(x=x, y=y, shape=Trt, col=ASD))+
geom_point(size=2, alpha=0.6)+
labs(title = 'PCA', x='Dim1 (77.2%)', y= 'Dim2 (10.9%)')+
#stat_ellipse()+
theme_bw(14)
ggplot(cbind(basic_plot$data, spectra2[, c('Trt', 'ASD', 'Group')]), aes(x=x, y=y, shape=Trt, col=ASD))+
geom_point(size=2, alpha=0.7)+
labs(title = 'PCA', x='Dim1 (77.2%)', y= 'Dim2 (10.9%)')+
#stat_ellipse()+
theme_bw(14)
ggplot(cbind(basic_plot$data, spectra2[, c('Trt', 'ASD', 'Group')]), aes(x=x, y=y, shape=Trt, col=ASD))+
geom_point(size=0.5, alpha=0.7)+
labs(title = 'PCA', x='Dim1 (77.2%)', y= 'Dim2 (10.9%)')+
#stat_ellipse()+
theme_bw(14)
ggplot(cbind(basic_plot$data, spectra2[, c('Trt', 'ASD', 'Group')]), aes(x=x, y=y, shape=Trt, col=ASD))+
geom_point(size=0.8, alpha=0.7)+
labs(title = 'PCA', x='Dim1 (77.2%)', y= 'Dim2 (10.9%)')+
#stat_ellipse()+
theme_bw(14)
res.pca <- prcomp(spectra2[spectra$ASD %in% c(1,2), 13:length(colnames(spectra2))], scale = FALSE)
res.pca <- prcomp(spectra2[spectra$ASD %in% c('1','2'), 13:length(colnames(spectra2))], scale = FALSE)
spectra2[spectra$ASD %in% c('1','2'), 13:length(colnames(spectra2))]
View(spectra2[spectra$ASD %in% c('1','2'), 13:length(colnames(spectra2))])
res.pca <- prcomp(spectra2[spectra2$ASD %in% c('1','2'), 13:length(colnames(spectra2))], scale = FALSE)
basic_plot <- fviz_pca_ind(res.pca, label= 'none')
ggplot(cbind(basic_plot$data, spectra2[spectra2$ASD %in% c('1','2'), c('Trt', 'ASD', 'Group')]), aes(x=x, y=y, shape=Trt, col=ASD))+
geom_point(size=0.8, alpha=0.7)+
labs(title = 'PCA', x='Dim1 (77.2%)', y= 'Dim2 (10.9%)')+
#stat_ellipse()+
theme_bw(14)
ggplot(cbind(basic_plot$data, spectra2[spectra2$ASD %in% c('1','2'), c('Trt', 'ASD', 'Group')]), aes(x=x, y=y, shape=Trt, col=ASD))+
geom_point(size=1.4, alpha=0.7)+
labs(title = 'PCA', x='Dim1 (77.2%)', y= 'Dim2 (10.9%)')+
#stat_ellipse()+
theme_bw(14)
ggplot(cbind(basic_plot$data, spectra2[spectra2$ASD %in% c('1','2'), c('Trt', 'ASD', 'Group')]), aes(x=x, y=y, shape=Trt, col=ASD))+
geom_point(size=1.4, alpha=0.7)+
labs(title = 'PCA of raw spectrum', x='Dim1 (77.2%)', y= 'Dim2 (10.9%)')+
#stat_ellipse()+
theme_bw(14)
ggplot(cbind(basic_plot$data, spectra2[spectra2$ASD %in% c('1','2'), c('Trt', 'ASD', 'Group')]), aes(x=x, y=y, shape=note, col=Trt))+
geom_point(size=1.4, alpha=0.7)+
labs(title = 'PCA of raw spectrum', x='Dim1 (77.2%)', y= 'Dim2 (10.9%)')+
#stat_ellipse()+
theme_bw(14)
ggplot(cbind(basic_plot$data, spectra2[spectra2$ASD %in% c('1','2'), c('Trt', 'ASD', 'Group')]), aes(x=x, y=y, col=ASD))+
geom_point(size=1.4, alpha=0.7)+
labs(title = 'PCA of raw spectrum', x='Dim1 (77.2%)', y= 'Dim2 (10.9%)')+
#stat_ellipse()+
theme_bw(14)
spectra <- read.csv("Raw_spectrum_merged")
View(spectra)
spectra$Rep <- factor(spectra$Rep)
spectra$Block <- factor(spectra$Block)
spectra$year <- factor(spectra$year)
spectra$genotype <- factor(spectra$genotype)
spectra$note <- factor(spectra$note)
spectra$Trt <- factor(spectra$Trt)
spectra$ASD <- factor(spectra$ASD)
spectra$rows <- as.numeric(spectra$rows)
spectra$ranges <- as.numeric(spectra$ranges)
spectra$PLOT.ID <- factor(spectra$PLOT.ID)
spectra <- subset(spectra, select = -c(X, Unnamed..0))
library(Matrix)
library(lme4)
library(reshape2)
library(rrBLUP)
library(ggplot2)
library(glmmTMB)
library(ncf)
library(viridisLite)
library(viridis)
library(tibble)
library(PerformanceAnalytics)
library(tidyverse)
spectra.new <- spectra
spectra.new$Block <- factor(spectra.new$Block, levels= c('2', '4', '1', '3'))
ggplot(spectra.new, aes(rows, ranges, color=X730)) +
geom_point(size=1.3) +
scale_y_continuous(name='ranges', limits = c(1,13))+
geom_rect( aes(xmin=0.4, xmax = 51, ymin = 7.5, ymax = 12.5), fill=NA, colour='red')+
#annotate('rect', xmin=0, xmax = 50, ymin = 7.5, ymax = 12.5, alpha= .1)+
facet_wrap(Block~Trt)+
scale_colour_viridis() +
labs(title = 'Range and Row effects on leaf spectrum', caption = ' Blocks 1 and 4 = + N , 2 and 3 = -N\nred rectangles are the hybrids ')+
theme_classic()
View(mid.heterosis.val_HN)
View(mid.heterosis.val_HN)
rm(mid.heterosis.val_HN)
rm(mid.heterosis.val_LN)
View(blues_plot)
rm(blues_plot)
rm(a)
rm(list=ls())
gc()
library(Matrix)
library(lme4)
library(reshape2)
library(rrBLUP)
library(ggplot2)
library(tidyverse)
library(zoom)
library(ggforce)
library(cowplot)
theme_set(theme_bw(10))
blups <- read.csv('spectra_blups.csv')
########################   CALCULATION OF MID-PARENT HETEROSIS   #####################################
## heterosis calculation for low nitrogen condition
blups_LN <- blups[blups$Trt == 'LN' & blups$Rep == 1 ,]
het <- blups_LN %>% filter(grepl(' X ', genotype))
mid.heterosis.val_LN <- expand.grid(bands= 350:2500, genotype = het$genotype)
mid.heterosis.val_LN$heterosis <- NA
str(blups)
spectra
blups$Rep <- factor(blups$Rep)
blups$Block <- factor(blups$Block)
blups$year <- factor(blups$year)
blups$genotype <- factor(blups$genotype)
blups$note <- factor(blups$note)
blups$Trt <- factor(blups$Trt)
blups$ASD <- factor(blups$ASD)
blups$Group <- factor(blups$Group)
blups$rows <- factor(blups$rows)
blups$ranges <- factor(blups$ranges)
blups$PLOT.ID <- factor(blups$PLOT.ID)
blups$ASD  <- factor(blups$ASD)
blups$Calibration <- factor(blups$Calibration)
str(blups)
## heterosis calculation for high nitrogen condition
blups_HN <- blups[blups$Trt == 'HN' & blups$Rep == 1 ,]
het <- blups_HN %>% filter(grepl(' X ', genotype))
lower_HN <- expand.grid(bands= 350:2500, genotype = het$genotype)
lower_HN$heterosis <- NA
length(colnames(het)
)
length(het$genotype)
View(het)
2163+337
blups_HN[which(blups_HN$genotype == female ), 5]
blups_HN[which(blups_HN$genotype ==  ), 5]
view(blups_HN)
blups_HN[which(blups_HN$genotype == 'B73' ), 5]
blups_HN[which(blups_HN$genotype == 'B73' ), 13]
mean(blups_HN[which(blups_HN$genotype == 'B73' ), 13])
## heterosis calculation for high nitrogen condition
blups_HN <- blups[blups$Trt == 'HN' & blups$Rep == 1 ,]
het <- blups_HN %>% filter(grepl(' X ', genotype))
lower_HN <- expand.grid(bands= 350:2500, genotype = het$genotype)
lower_HN$heterosis <- NA
for(i in 1:length(het$genotype)){
for(j in 13:length(colnames(het))){
hybrid <- as.character(het$genotype[i])
female <- strsplit(as.character(het$genotype[i]), ' X ')[[1]][1]
male <- strsplit(as.character(het$genotype[i]), ' X ')[[1]][2]
if(mean(blups_HN$genotype %in% c(female)) > 0 & mean(blups_HN$genotype %in% c(male) > 0 )) {
female2 <- mean(blups_HN[which(blups_HN$genotype == female ), j])
male2 <- mean(blups_HN[which(blups_HN$genotype == male ), j])
lower <- min(c(female2, male2))
hybrid2 <- mean(blups_HN[which(blups_HN$genotype == hybrid ), j])
heterosis <- (lower-hybrid2)/lower*100
lower_HN[lower_HN$bands == j+337 & lower_HN$genotype == hybrid , 'heterosis'] <- heterosis
print(i)
print(j)
}
else
print('pass')
}
}
males <- c()
for(i in 1:length(lower_HN$genotype)){
male <- strsplit(as.character(lower_HN$genotype[i]), ' X ')[[1]][2]
males<- c(males,  male)
print(i)
}
lower_HN$male <- males
lower_HN <- na.omit(lower_HN)
lower_HN$male <- factor(lower_HN$male)
data_lower_HN <- lower_HN[lower_HN$male %in% c('B73', 'Mo17'),] %>% group_by(male,bands) %>%
summarise(mean.heterosis = mean(heterosis, na.rm=TRUE), sd.heterosis = sd(heterosis, na.rm = TRUE), se.heterosis= sd(heterosis, na.rm=TRUE)/sqrt(length(heterosis)),
max = max(heterosis, na.rm = TRUE), min = min(heterosis, na.rm = TRUE))
p5 <- ggplot(data=data_lower_HN, aes(x=bands, group= male)) +
geom_line(aes(y=mean.heterosis, color=male), size = 0.7)+
geom_ribbon(aes(ymin=mean.heterosis-se.heterosis , ymax=mean.heterosis+se.heterosis , fill=male),alpha=0.4)+
labs(title = 'Lower-parent Heterosis in HN', caption = '**Envelopes represent 1 se from the mean')
p5
########################   CALCULATION OF MID-PARENT HETEROSIS   #####################################
## heterosis calculation for low nitrogen condition
blups_LN <- blups[blups$Trt == 'LN' & blups$Rep == 1 ,]
het <- blups_LN %>% filter(grepl(' X ', genotype))
mid_LN <- expand.grid(bands= 350:2500, genotype = het$genotype)
mid_LN$heterosis <- NA
for(i in 1:length(het$genotype)){
for(j in 13:length(colnames(het))){
hybrid <- as.character(het$genotype[i])
female <- strsplit(as.character(het$genotype[i]), ' X ')[[1]][1]
male <- strsplit(as.character(het$genotype[i]), ' X ')[[1]][2]
if(mean(blups_LN$genotype %in% c(female)) > 0 & mean(blups_LN$genotype %in% c(male) > 0 )) {
female2 <- mean(blups_LN[which(blups_LN$genotype == female ), j])
male2 <- mean(blups_LN[which(blups_LN$genotype == male ), j])
hybrid2 <- mean(blups_LN[which(blups_LN$genotype == hybrid ), j])
heterosis <- (hybrid2-mean(c(male2,female2)))/mean(c(male2,female2))*100
mid_LN[mid_LN$bands == j+337 & mid_LN$genotype == hybrid , 'heterosis'] <- heterosis
print(i)
print(j)
}
else {
print('pass')
}
}
}
males <- c()
for(i in 1:length(mid_LN$genotype)){
male <- strsplit(as.character(mid_LN$genotype[i]), ' X ')[[1]][2]
males<- c(males,  male)
print(i)
}
mid_LN$male <- males
mid_LN <- na.omit(mid_LN)
data_mid_LN <- mid_LN[mid_LN$male %in% c('B73', 'Mo17'),] %>% group_by(male,bands) %>%
summarise(mean.heterosis = mean(heterosis, na.rm=TRUE), sd.heterosis = sd(heterosis, na.rm = TRUE), se.heterosis= sd(heterosis, na.rm=TRUE)/sqrt(length(heterosis)),
max = max(heterosis, na.rm = TRUE), min = min(heterosis, na.rm = TRUE))
p4 <- ggplot(data_mid_LN=data_mid_LN, aes(x=bands, group= male)) +
geom_line(aes(y=mean.heterosis, color=male), size = 0.7)+
geom_ribbon(aes(ymin=mean.heterosis-se.heterosis , ymax=mean.heterosis+se.heterosis , fill=male),alpha=0.4)+
labs(title = 'Mid-parent Heterosis in LN', caption = '**Envelopes represent 1 se from the mean')
p4
